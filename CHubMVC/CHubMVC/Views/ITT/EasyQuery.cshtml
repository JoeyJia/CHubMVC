
@{
    ViewBag.Title = "Easy Query";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style typeof="text/css">
    .titleTD {
        background-color: #FFCC99;
    }

</style>





<div class="container-fluid" id="easyQueryBody" ng-app="easyQueryApp" ng-controller="easyQueryCtrl">
    <div class="panel panel-default">
        <div class="panel-heading"><b>Easy Query</b></div>

        <form class="form-horizontal" id="searchForm">
            <div class="row" style="margin-top:20px;margin-bottom:20px">
                <div class="form-group">
                    <label for="orderID" class="col-sm-2 control-label small">Part No.</label>
                    <div class="col-sm-2 col-lg-2">
                        <input type="text" class="form-control input-sm" ng-model="partNo" placeholder="Part No.">
                    </div>
                    <div class="col-sm-2">
                        <button class="btn btn-primary btn-sm" ng-click="fuzzySearch()">Search</button>
                    </div>
                </div>

            </div>
        </form>
        <hr>
        
        <!--Page body-->
        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Part Basic Info</b></div>
                    <table class="table table-bordered table-condensed" >

                        <tr>
                            <td class="titleTD"><b>PartNo</b></td>
                            <td colspan="3">{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td style="width:180px" class="titleTD"><b>Description</b></td>
                            <td >{{selectedPart.DESCRIPTION}}</td>
                            <td style="width:150px" class="titleTD"><b>Chinese Desc</b></td>
                            <td >{{selectedPart.DESC_CN}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Buyer</b></td>
                            <td>{{selectedPart.PLANNER_BUYER}}</td>
                            <td class="titleTD"><b>Print Part No.</b></td>
                            <td>{{selectedPart.PRINT_PART_NO}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>SSC</b></td>
                            <td>{{selectedPart.CURRENT_SALES_STATUS_CODE}}</td>
                            <td class="titleTD"><b>Part Status</b></td>
                            <td>{{selectedPart.PART_STATUS}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>L*W*H</b></td>
                            <td>{{selectedPart.LWH}}</td>
                            <td class="titleTD"><b>Weight</b></td>
                            <td>{{selectedPart.PART_WEIGHT}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Make to Order</b></td>
                            <td>{{selectedPart.MAKE_TO_FLAG}}</td>
                            <td class="titleTD"><b>Tran Code</b></td>
                            <td>{{selectedPart.TRANSP_PART_CODE}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Release Date</b></td>
                            <td>{{selectedPart.CREATE_DATE}}</td>
                            <td class="titleTD"><b>Note</b></td>
                            <td>{{selectedPart.NOTE_TEXT}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Remark 1</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                            <td class="titleTD"><b>Remark 2</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Remark 3</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                            <td class="titleTD"><b>Remark 4</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Remark 5</b></td>
                            <td colspan="3">{{selectedPart.PART_NO}}</td>
                        </tr>
                        <!--CIQ Features part-->
                        <tr>
                            <td style="background-color:#DCDCDC" colspan="4"><b>TC Features</b></td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Declaration Name</b></td>
                            <td>{{mdmData.DECLARATION_NAME}}</td>
                            <td class="titleTD"><b>HS Code</b></td>
                            <td>{{mdmData.HSCODE}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>TC Category Identified</b></td>
                            <td colspan="3">{{mdmData.TC_CATEGORY_BY_MAN}}</td>
                        </tr>
                        <tr>
                            <td class="titleTD"><b>Note</b></td>
                            <td colspan="3">{{mdmData.NOTE1}}</td>
                        </tr>


                    </table>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading"><b>Watching Out</b></div>
                            <table class="table table-bordered table-condensed">
                                <thead style="background-color:#C32518">
                                    <tr>
                                        <th>Message</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tr ng-repeat="w in watchingList ">
                                    <td ng-style="{backgroundColor:w.COLOR}">{{w.WATCH_MSG}}</td>
                                    <td ng-style="{backgroundColor:w.COLOR}">{{w.WATCH_DETAIL}}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!--Inventory Shapshot Part-->
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading"><b>Inventory Shapshot</b></div>
                            <table class="table table-bordered table-condensed">
                                <thead style="background-color:#C32518">
                                    <tr>

                                        <th>Ware House</th>
                                        <th>Bay No</th>
                                        <th>Qty Available</th>
                                        <th>Qty Onhand</th>
                                        <th>Qty Reserved</th>
                                        <th>Qty In Receiving</th>
                                    </tr>
                                </thead>
                                <tr style="background-color:#FFCC99" ng-repeat="ip in invPDCList">

                                    <td>{{ip.WH_ALIAS}}</td>
                                    <td>{{ip.BAY_NO}}</td>
                                    <td>{{ip.QTY_AVL}}</td>
                                    <td>{{ip.QTY_ONHAND}}</td>
                                    <td>{{ip.QTY_RESERVED}}</td>
                                    <td>{{ip.QTY_IN_RECEIVING}}</td>
                                </tr>

                                <tr style="background-color:#FF9999" ng-repeat="ir in invRDCList">

                                    <td>{{ir.WH_ALIAS}}</td>
                                    <td>{{ir.BAY_NO}}</td>
                                    <td>{{ir.QTY_AVL}}</td>
                                    <td>{{ir.QTY_ONHAND}}</td>
                                    <td>{{ir.QTY_RESERVED}}</td>
                                    <td>{{ir.QTY_IN_RECEIVING}}</td>
                                </tr>

                                <tr style="background-color:#FFCCCC" ng-repeat="iip in invInterPDCList">

                                    <td>{{iip.WH_ALIAS}}</td>
                                    <td>{{iip.BAY_NO}}</td>
                                    <td>{{iip.QTY_AVL}}</td>
                                    <td>{{iip.QTY_ONHAND}}</td>
                                    <td>{{iip.QTY_RESERVED}}</td>
                                    <td>{{iip.QTY_IN_RECEIVING}}</td>
                                </tr>

                            </table>
                        </div>
                    </div>
                </div>

                <!--SO/PO Opening Qty Snap Shot Part-->
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading"><b>SO/PO Opening Qty Snap Shot</b></div>
                            <table class="table table-bordered table-condensed">
                                <tr>

                                    <td rowspan="2">Warehouse</td>
                                    <td colspan="4">Sales Orders</td>
                                    <td colspan="3">Purchasing Orders</td>
                                </tr>
                                <tr>
                                    <td>Qty BackOrdered</td>
                                    <td>Qty Opening</td>
                                    <td>Qty Reserved</td>
                                    <td>Qty in Picking</td>
                                    <td>Remaining Qtys</td>
                                    <td>Latest ETA</td>
                                    <td>IN Transit</td>
                                </tr>
                                <tr style="background-color:#FFCC99" ng-repeat="op in openPDCList">

                                    <td>{{op.WHAlias}}</td>
                                    <td>{{op.BackOrderedQty}}</td>
                                    <td>{{op.OpeningQty}}</td>
                                    <td>{{op.ReservedQty}}</td>
                                    <td>{{op.InPickingQty}}</td>
                                    <td>{{op.RemainingQty}}</td>
                                    <td>{{op.LatestETA}}</td>
                                    <td>{{op.InTransit}}</td>
                                </tr>

                                <tr style="background-color:#FF9999" ng-repeat="or in openRDCList">

                                    <td>{{or.WHAlias}}</td>
                                    <td>{{or.BackOrderedQty}}</td>
                                    <td>{{or.OpeningQty}}</td>
                                    <td>{{or.ReservedQty}}</td>
                                    <td>{{or.InPickingQty}}</td>
                                    <td>{{or.RemainingQty}}</td>
                                    <td>{{or.LatestETA}}</td>
                                    <td>{{or.InTransit}}</td>
                                </tr>

                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>



        <div class="row">
            <div class="col-md-11">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>SO/PO Opening Qty Snap Shot</b></div>

                    <ul class="nav nav-pills" role="tablist">
                        <li role="presentation" class="active"><a href="#home" role="tab" data-toggle="tab">By Shipments</a></li>
                        <li role="presentation"><a href="#profile" role="tab" data-toggle="tab">By Purchasing</a></li>
                    </ul>

                    <!---->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            <div class="row">
                                <div class="col-md-10">
                                    From:
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">All
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">MDC
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3">MPDC
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3">SPDC
                                    </label>

                                    
                                </div>
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="profile">Purchasing content</div>
                    </div> 
                    </div>
                </div>
        </div>

    </div>
</div>


<!--Part List Modal-->
<div class="modal fade" id="partListModal" role="dialog" aria-labelledby="result" aria-hidden="true" ng-app="partListApp" ng-controller="partListCtrl">
    <div class="modal-dialog" style="width:90%">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Part No List</h4>
            </div>

            <div class="modal-body">

                <table id="tbPartNoList" class="table table-striped table-hover table-bordered .table-condensed">
                    <thead>
                        <tr>
                            <th style="width:10px"></th>
                            <th style="">Part No.</th>
                            <th style="">Description</th>
                            <th style="">Chinese Desc</th>
                            <th>Buyer</th>
                            <th>Part Status</th>
                            <th>SSC</th>
                            <th>Print Part No.</th>
                            <th>L*W*H</th>
                            <th>Weight</th>
                        </tr>
                    </thead>
                    <tbody style="">
                        <tr ng-repeat="pl in partList ">
                            <td style="">
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="optionsRdios" id="optionsRdios$index" class="partRadio" seq="{{$index}}" value="">
                                    </label>
                                </div>
                            </td>
                            <td>{{pl.PART_NO}}</td>
                            <td>{{pl.DESCRIPTION}}</td>
                            <td>{{pl.DESC_CN}}</td>
                            <td>{{pl.PLANNER_BUYER}}</td>
                            <td>{{pl.PART_STATUS}}</td>
                            <td>{{pl.CURRENT_SALES_STATUS_CODE}}</td>
                            <td>{{pl.PRINT_PART_NO}}</td>
                            <td>{{pl.LWH}}</td>
                            <td>{{pl.PART_WEIGHT}}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-md-2 col-md-offset-10">
                        <button type="button" class="btn btn-primary" onclick="confirmAddr()">Confirm</button>
                        <button type="button" class="btn btn-primary" onclick="cancelAddr()">Cancel</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    

    angular.module('easyQueryApp', []).controller('easyQueryCtrl', function ($scope, $http) {
        $scope.result = [];
        $scope.partNo = "";
        $scope.selectedPart = "";
        $scope.logSeq = 0;
        
        $scope.watchingList = [];
        $scope.mdmData = "";

        $scope.invPDCList = [];
        $scope.invRDCList = [];
        $scope.invInterPDCList = [];

        $scope.openPDCList = [];
        $scope.openRDCList = [];


        $scope.fuzzySearch = function () {
            if ($scope.partNo == "")
                return;

            $.ajax({
                url: "/itt/FuzzyQueryParNo",
                data: {
                    fuzzypartNo: $scope.partNo,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    //debugger;
                    $scope.result = obj;
                    if ($scope.result != null && $scope.result.length == 1) {
                        $scope.selectedPart = $scope.result[0];
                        $scope.initAlldata();
                        //initAlldata();
                    }
                    else {
                        var appElement = document.querySelector('[ng-controller=partListCtrl]');
                        var scope = angular.element(appElement).scope();
                        scope.partList = $scope.result;
                        scope.$apply();
                        $("#partListModal").modal("show");
                    }

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });

        };

        $scope.initAlldata = function()
        {
            //debugger;
            //windows.body.style.cursor = "wait"
            addEQLog();
            getWatchingout();
            getMDMData();
            getInvSnapShot();
            getOpenSnapShot();
            //windows.body.style.cursor = "default"
    

        };

        //function part
        function addEQLog()
        {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/AddEasyQueryLog",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    if (obj.Success) {
                        
                        $scope.logSeq = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getWatchingout()
        {
            if ($scope.logSeq == 0)
                return;

            $.ajax({
                url: "/itt/GetWatchingOutList",
                data: {
                    token: $scope.logSeq,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    
                    if (obj.Success) {
                        $scope.watchingList = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getMDMData() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetMDMData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                   
                    if (obj.Success) {
                        $scope.mdmData = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getInvSnapShot() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetInvSnapShotData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    //debugger;
                    if (obj.Success) {
                        $scope.invPDCList = obj.Data.pdcList;
                        $scope.invRDCList = obj.Data.rdcList;
                        $scope.invInterPDCList = obj.Data.interPDCList;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        };

        function getOpenSnapShot() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetOpenSnapShotData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    //debugger;
                    if (obj.Success) {
                        $scope.openPDCList = obj.Data.pdcList;
                        $scope.openRDCList = obj.Data.rdcList;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        };

    });

    //manual load app
    angular.bootstrap(document.getElementById("easyQueryBody"), ['easyQueryApp']);

    //For part modal part
    angular.module('partListApp', []).controller('partListCtrl', function ($scope, $http) {
        $scope.partList = [];


        //$scope.cancel = function () {
        //    $("#partReadModal").modal("hide");
        //}

        //$scope.showAuditLog = function () {
        //    //debugger;
        //    var appElement = document.querySelector('[ng-controller=auditLogCtrl]');
        //    var scope = angular.element(appElement).scope();
        //    scope.partNo = $scope.currentData.PART_NO;
        //    scope.loadAuditLog();
        //    scope.$apply();
        //    $("#auditLogModal").modal("show");
        //}


    });

    //Add second app to document
    angular.bootstrap(document.getElementById("partListModal"), ['partListApp']);
</script>
<script>

    function confirmAddr() {
        for (var i = 0; i < $(".partRadio").length ; i++) {
            if ($(".partRadio")[i].checked) {
                var seq = $(".partRadio")[i].attributes['seq'].value;
                var appElement = document.querySelector('[ng-controller=partListCtrl]');
                var scope = angular.element(appElement).scope();
                var selected = scope.partList[seq];

                var appElement1 = document.querySelector('[ng-controller=easyQueryCtrl]');
                var scope1 = angular.element(appElement1).scope();
                scope1.selectedPart = selected;
                
                scope1.$apply();
                scope1.initAlldata();
                break;
            }

        }
        $("#partListModal").modal("hide");
    }

    function cancelAddr() {
        $("#partListModal").modal("hide");
    }

</script>
