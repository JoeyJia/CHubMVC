
@{
    ViewBag.Title = "Easy Query";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container-fluid" id="easyQueryBody" ng-app="easyQueryApp" ng-controller="easyQueryCtrl">
    <div class="panel panel-default">
        <div class="panel-heading"><b>Easy Query</b></div>

        <form class="form-horizontal" id="searchForm">
            <div class="row" style="margin-top:20px;margin-bottom:20px">
                <div class="form-group">
                    <label for="orderID" class="col-sm-2 control-label small">Part No.</label>
                    <div class="col-sm-2 col-lg-2">
                        <input type="text" class="form-control input-sm" ng-model="partNo" placeholder="Part No.">
                    </div>
                    <div class="col-sm-2">
                        <button class="btn btn-primary btn-sm" ng-click="fuzzySearch()">Search</button>
                    </div>
                </div>

            </div>
        </form>
        <hr>
        
        <!--Page body-->
        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Part Basic Info</b></div>
                    <table class="table table-bordered table-striped .table-condensed" >

                        <tr>
                            <td style=""><b>PartNo</b></td>
                            <td colspan="3">{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Description</b></td>
                            <td >{{selectedPart.DESCRIPTION}}</td>
                            <td style=""><b>Chinese Desc</b></td>
                            <td >{{selectedPart.DESC_CN}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Buyer</b></td>
                            <td>{{selectedPart.PLANNER_BUYER}}</td>
                            <td style=""><b>Print Part No.</b></td>
                            <td>{{selectedPart.PRINT_PART_NO}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>SSC</b></td>
                            <td>{{selectedPart.CURRENT_SALES_STATUS_CODE}}</td>
                            <td style=""><b>Part Status</b></td>
                            <td>{{selectedPart.PART_STATUS}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>L*W*H</b></td>
                            <td>{{selectedPart.LWH}}</td>
                            <td style=""><b>Weight</b></td>
                            <td>{{selectedPart.PART_WEIGHT}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Make to Order</b></td>
                            <td>{{selectedPart.MAKE_TO_FLAG}}</td>
                            <td style=""><b>Tran Code</b></td>
                            <td>{{selectedPart.TRANSP_PART_CODE}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Release Date</b></td>
                            <td>{{selectedPart.CREATE_DATE}}</td>
                            <td style=""><b>Note</b></td>
                            <td>{{selectedPart.NOTE_TEXT}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Remark 1</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                            <td style=""><b>Remark 2</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Remark 3</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                            <td style=""><b>Remark 4</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                        </tr>
                        <tr>
                            <td style=""><b>Remark 5</b></td>
                            <td>{{selectedPart.PART_NO}}</td>
                        </tr>
                        <!--CIQ Features part-->
                        <tr>
                            <td style="" colspan="4"><b>CIQ Features</b></td>
                        </tr>
                        <tr>
                            <td style="">Declaration Name</td>
                            <td>{{mdmData.DECLARATION_NAME}}</td>
                            <td style="">HS Code</td>
                            <td>{{mdmData.HSCODE}}</td>
                        </tr>
                        <tr>
                            <td style="">TC Category Identified</td>
                            <td>{{mdmData.TC_CATEGORY_BY_MAN}}</td>
                        </tr>
                        <tr>
                            <td style="">Note</td>
                            <td>{{mdmData.NOTE1}}</td>
                        </tr>


                    </table>
                </div>
            </div>
            <div class="col-md-5">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Watching Out</b></div>
                    <table class="table table-bordered table-striped .table-condensed" style="border-color:black;">
                        <thead>
                            <tr>
                                <th>Message</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tr ng-repeat="w in watchingList ">
                            <td style="">{{w.WATCH_MSG}}</td>
                            <td ng-style ="{backgroundColor:w.COLOR}">{{w.WATCH_DETAIL}}</td>
                        </tr>


                    </table>
                </div>
            </div>
        </div>

        <!--Inventory Shapshot Part-->
        <div class="row">
            <div class="col-md-10">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Inventory Shapshot</b></div>
                    <table class="table table-bordered table-striped .table-condensed" style="border-color:black;">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Ware House</th>
                                <th>Bay No</th>
                                <th>Qty Available</th>
                                <th>Qty Onhand</th>
                                <th>Qty Reserved</th>
                                <th>Qty In Receiving</th>
                            </tr>
                        </thead>
                        <tr>
                            <td rowspan="2">China PDC</td>
                            <td>{{invPDCList[0].WH_ALIAS}}</td>
                            <td>{{invPDCList[0].BAY_NO}}</td>
                            <td>{{invPDCList[0].QTY_AVL}}</td>
                            <td>{{invPDCList[0].QTY_ONHAND}}</td>
                            <td>{{invPDCList[0].QTY_RESERVED}}</td>
                            <td>{{invPDCList[0].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                          
                            <td>{{invPDCList[1].WH_ALIAS}}</td>
                            <td>{{invPDCList[1].BAY_NO}}</td>
                            <td>{{invPDCList[1].QTY_AVL}}</td>
                            <td>{{invPDCList[1].QTY_ONHAND}}</td>
                            <td>{{invPDCList[1].QTY_RESERVED}}</td>
                            <td>{{invPDCList[1].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                            <td rowspan="4">China RDC</td>
                            <td>{{invRDCList[0].WH_ALIAS}}</td>
                            <td>{{invRDCList[0].BAY_NO}}</td>
                            <td>{{invRDCList[0].QTY_AVL}}</td>
                            <td>{{invRDCList[0].QTY_ONHAND}}</td>
                            <td>{{invRDCList[0].QTY_RESERVED}}</td>
                            <td>{{invRDCList[0].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                          
                            <td>{{invRDCList[1].WH_ALIAS}}</td>
                            <td>{{invRDCList[1].BAY_NO}}</td>
                            <td>{{invRDCList[1].QTY_AVL}}</td>
                            <td>{{invRDCList[1].QTY_ONHAND}}</td>
                            <td>{{invRDCList[1].QTY_RESERVED}}</td>
                            <td>{{invRDCList[1].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                           
                            <td>{{invRDCList[2].WH_ALIAS}}</td>
                            <td>{{invRDCList[2].BAY_NO}}</td>
                            <td>{{invRDCList[2].QTY_AVL}}</td>
                            <td>{{invRDCList[2].QTY_ONHAND}}</td>
                            <td>{{invRDCList[2].QTY_RESERVED}}</td>
                            <td>{{invRDCList[2].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                            
                            <td>{{invRDCList[3].WH_ALIAS}}</td>
                            <td>{{invRDCList[3].BAY_NO}}</td>
                            <td>{{invRDCList[3].QTY_AVL}}</td>
                            <td>{{invRDCList[3].QTY_ONHAND}}</td>
                            <td>{{invRDCList[3].QTY_RESERVED}}</td>
                            <td>{{invRDCList[3].QTY_IN_RECEIVING}}</td>
                        </tr>

                        <tr>
                            <td rowspan="3">Inter PDC</td>
                            <td>{{invInterPDCList[0].WH_ALIAS}}</td>
                            <td>{{invInterPDCList[0].BAY_NO}}</td>
                            <td>{{invInterPDCList[0].QTY_AVL}}</td>
                            <td>{{invInterPDCList[0].QTY_ONHAND}}</td>
                            <td>{{invInterPDCList[0].QTY_RESERVED}}</td>
                            <td>{{invInterPDCList[0].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                            
                            <td>{{invInterPDCList[1].WH_ALIAS}}</td>
                            <td>{{invInterPDCList[1].BAY_NO}}</td>
                            <td>{{invInterPDCList[1].QTY_AVL}}</td>
                            <td>{{invInterPDCList[1].QTY_ONHAND}}</td>
                            <td>{{invInterPDCList[1].QTY_RESERVED}}</td>
                            <td>{{invInterPDCList[1].QTY_IN_RECEIVING}}</td>
                        </tr>
                        <tr>
                            
                            <td>{{invInterPDCList[2].WH_ALIAS}}</td>
                            <td>{{invInterPDCList[2].BAY_NO}}</td>
                            <td>{{invInterPDCList[2].QTY_AVL}}</td>
                            <td>{{invInterPDCList[2].QTY_ONHAND}}</td>
                            <td>{{invInterPDCList[2].QTY_RESERVED}}</td>
                            <td>{{invInterPDCList[2].QTY_IN_RECEIVING}}</td>
                        </tr>
                       
                    </table>
                </div>
            </div>
        </div>

        <!--SO/PO Opening Qty Snap Shot Part-->
        <div class="row">
            <div class="col-md-11">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>SO/PO Opening Qty Snap Shot</b></div>
                    <table class="table table-bordered table-striped .table-condensed" style="border-color:black;">
                        <tr>
                            <td rowspan="2">Item</td>
                            <td rowspan="2">Warehouse</td>
                            <td colspan="4">Sales Orders</td>
                            <td colspan="3">Purchasing Orders</td>
                        </tr>
                        <tr>
                            <td>Qty BackOrdered</td>
                            <td>Qty Opening</td>
                            <td>Qty Reserved</td>
                            <td>Qty in Picking</td>
                            <td>Remaining Qtys</td>
                            <td>Latest ETA</td>
                            <td>IN Transit</td>
                        </tr>
                        <tr>
                            <td rowspan="2">China PDC</td>
                            <td>{{openPDCList[0].WHAlias}}</td>
                            <td>{{openPDCList[0].BackOrderedQty}}</td>
                            <td>{{openPDCList[0].OpeningQty}}</td>
                            <td>{{openPDCList[0].ReservedQty}}</td>
                            <td>{{openPDCList[0].InPickingQty}}</td>
                            <td>{{openPDCList[0].RemainingQty}}</td>
                            <td>{{openPDCList[0].LatestETA}}</td>
                            <td>{{openPDCList[0].InTransit}}</td>
                        </tr>
                        <tr>

                            <td>{{openPDCList[1].WHAlias}}</td>
                            <td>{{openPDCList[1].BackOrderedQty}}</td>
                            <td>{{openPDCList[1].OpeningQty}}</td>
                            <td>{{openPDCList[1].ReservedQty}}</td>
                            <td>{{openPDCList[1].InPickingQty}}</td>
                            <td>{{openPDCList[1].RemainingQty}}</td>
                            <td>{{openPDCList[1].LatestETA}}</td>
                            <td>{{openPDCList[1].InTransit}}</td>
                        </tr>

                        <tr>
                            <td rowspan="4">China RDC</td>
                            <td>{{openRDCList[0].WHAlias}}</td>
                            <td>{{openRDCList[0].BackOrderedQty}}</td>
                            <td>{{openRDCList[0].OpeningQty}}</td>
                            <td>{{openRDCList[0].ReservedQty}}</td>
                            <td>{{openRDCList[0].InPickingQty}}</td>
                            <td>{{openRDCList[0].RemainingQty}}</td>
                            <td>{{openRDCList[0].LatestETA}}</td>
                            <td>{{openRDCList[0].InTransit}}</td>
                        </tr>
                        <tr>

                            <td>{{openRDCList[1].WHAlias}}</td>
                            <td>{{openRDCList[1].BackOrderedQty}}</td>
                            <td>{{openRDCList[1].OpeningQty}}</td>
                            <td>{{openRDCList[1].ReservedQty}}</td>
                            <td>{{openRDCList[1].InPickingQty}}</td>
                            <td>{{openRDCList[1].RemainingQty}}</td>
                            <td>{{openRDCList[1].LatestETA}}</td>
                            <td>{{openRDCList[1].InTransit}}</td>
                        </tr>
                        <tr>

                            <td>{{openRDCList[2].WHAlias}}</td>
                            <td>{{openRDCList[2].BackOrderedQty}}</td>
                            <td>{{openRDCList[2].OpeningQty}}</td>
                            <td>{{openRDCList[2].ReservedQty}}</td>
                            <td>{{openRDCList[2].InPickingQty}}</td>
                            <td>{{openRDCList[2].RemainingQty}}</td>
                            <td>{{openRDCList[2].LatestETA}}</td>
                            <td>{{openRDCList[2].InTransit}}</td>
                        </tr>
                        <tr>

                            <td>{{openRDCList[3].WHAlias}}</td>
                            <td>{{openRDCList[3].BackOrderedQty}}</td>
                            <td>{{openRDCList[3].OpeningQty}}</td>
                            <td>{{openRDCList[3].ReservedQty}}</td>
                            <td>{{openRDCList[3].InPickingQty}}</td>
                            <td>{{openRDCList[3].RemainingQty}}</td>
                            <td>{{openRDCList[3].LatestETA}}</td>
                            <td>{{openRDCList[3].InTransit}}</td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-11">
                <div class="panel panel-default">
                    <div class="panel-heading"><b>SO/PO Opening Qty Snap Shot</b></div>

                    <ul class="nav nav-pills" role="tablist">
                        <li role="presentation" class="active"><a href="#home" role="tab" data-toggle="tab">By Shipments</a></li>
                        <li role="presentation"><a href="#profile" role="tab" data-toggle="tab">By Purchasing</a></li>
                    </ul>

                    <!---->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            Shipment Content
                        </div>
                        <div role="tabpanel" class="tab-pane" id="profile">Purchasing content</div>
                    </div> 
                    </div>
                </div>
        </div>

    </div>
</div>


<!--Part List Modal-->
<div class="modal fade" id="partListModal" role="dialog" aria-labelledby="result" aria-hidden="true" ng-app="partListApp" ng-controller="partListCtrl">
    <div class="modal-dialog" style="width:90%">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Part No List</h4>
            </div>

            <div class="modal-body">

                <table id="tbPartNoList" class="table table-striped table-hover table-bordered .table-condensed">
                    <thead>
                        <tr>
                            <th style="width:10px"></th>
                            <th style="">Part No.</th>
                            <th style="">Description</th>
                            <th style="">Chinese Desc</th>
                            <th>Buyer</th>
                            <th>Part Status</th>
                            <th>SSC</th>
                            <th>Print Part No.</th>
                            <th>L*W*H</th>
                            <th>Weight</th>
                        </tr>
                    </thead>
                    <tbody style="">
                        <tr ng-repeat="pl in partList ">
                            <td style="">
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="optionsRdios" id="optionsRdios$index" class="partRadio" seq="{{$index}}" value="">
                                    </label>
                                </div>
                            </td>
                            <td>{{pl.PART_NO}}</td>
                            <td>{{pl.DESCRIPTION}}</td>
                            <td>{{pl.DESC_CN}}</td>
                            <td>{{pl.PLANNER_BUYER}}</td>
                            <td>{{pl.PART_STATUS}}</td>
                            <td>{{pl.CURRENT_SALES_STATUS_CODE}}</td>
                            <td>{{pl.PRINT_PART_NO}}</td>
                            <td>{{pl.LWH}}</td>
                            <td>{{pl.PART_WEIGHT}}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-md-2 col-md-offset-10">
                        <button type="button" class="btn btn-primary" onclick="confirmAddr()">Confirm</button>
                        <button type="button" class="btn btn-primary" onclick="cancelAddr()">Cancel</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    

    angular.module('easyQueryApp', []).controller('easyQueryCtrl', function ($scope, $http) {
        $scope.result = [];
        $scope.partNo = "";
        $scope.selectedPart = "";
        $scope.logSeq = 0;
        
        $scope.watchingList = [];
        $scope.mdmData = "";

        $scope.invPDCList = [];
        $scope.invRDCList = [];
        $scope.invInterPDCList = [];

        $scope.openPDCList = [];
        $scope.openRDCList = [];


        $scope.fuzzySearch = function () {
            if ($scope.partNo == "")
                return;

            $.ajax({
                url: "/itt/FuzzyQueryParNo",
                data: {
                    fuzzypartNo: $scope.partNo,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    debugger;
                    $scope.result = obj;
                    if ($scope.result != null && $scope.result.length == 1) {
                        $scope.selectedPart = $scope.result[0];
                        $scope.initAlldata();
                        //initAlldata();
                    }
                    else {
                        var appElement = document.querySelector('[ng-controller=partListCtrl]');
                        var scope = angular.element(appElement).scope();
                        scope.partList = $scope.result;
                        scope.$apply();
                        $("#partListModal").modal("show");
                    }

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });

        };

        $scope.initAlldata = function()
        {
            debugger;
            addEQLog();
            getWatchingout();
            getMDMData();
            getInvSnapShot();
            getOpenSnapShot();

        };

        //function part
        function addEQLog()
        {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/AddEasyQueryLog",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    if (obj.Success) {
                        
                        $scope.logSeq = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getWatchingout()
        {
            if ($scope.logSeq == 0)
                return;

            $.ajax({
                url: "/itt/GetWatchingOutList",
                data: {
                    token: $scope.logSeq,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    
                    if (obj.Success) {
                        $scope.watchingList = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getMDMData() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetMDMData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                   
                    if (obj.Success) {
                        $scope.mdmData = obj.Data;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        }

        function getInvSnapShot() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetInvSnapShotData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    debugger;
                    if (obj.Success) {
                        $scope.invPDCList = obj.Data.pdcList;
                        $scope.invRDCList = obj.Data.rdcList;
                        $scope.invInterPDCList = obj.Data.interPDCList;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        };

        function getOpenSnapShot() {
            if ($scope.selectedPart == "")
                return;

            $.ajax({
                url: "/itt/GetOpenSnapShotData",
                data: {
                    partNo: $scope.selectedPart.PART_NO,
                },
                type: "post",
                async: false,
                success: function (obj) {
                    debugger;
                    if (obj.Success) {
                        $scope.openPDCList = obj.Data.pdcList;
                        $scope.openRDCList = obj.Data.rdcList;
                    }
                    else
                        alert(obj.Msg);

                },
                error: function (obj) {
                    alert(obj.responseText);
                }
            });
        };

    });

    //manual load app
    angular.bootstrap(document.getElementById("easyQueryBody"), ['easyQueryApp']);

    //For part modal part
    angular.module('partListApp', []).controller('partListCtrl', function ($scope, $http) {
        $scope.partList = [];


        //$scope.cancel = function () {
        //    $("#partReadModal").modal("hide");
        //}

        //$scope.showAuditLog = function () {
        //    //debugger;
        //    var appElement = document.querySelector('[ng-controller=auditLogCtrl]');
        //    var scope = angular.element(appElement).scope();
        //    scope.partNo = $scope.currentData.PART_NO;
        //    scope.loadAuditLog();
        //    scope.$apply();
        //    $("#auditLogModal").modal("show");
        //}


    });

    //Add second app to document
    angular.bootstrap(document.getElementById("partListModal"), ['partListApp']);
</script>
<script>

    function confirmAddr() {
        for (var i = 0; i < $(".partRadio").length ; i++) {
            if ($(".partRadio")[i].checked) {
                var seq = $(".partRadio")[i].attributes['seq'].value;
                var appElement = document.querySelector('[ng-controller=partListCtrl]');
                var scope = angular.element(appElement).scope();
                var selected = scope.partList[seq];

                var appElement1 = document.querySelector('[ng-controller=easyQueryCtrl]');
                var scope1 = angular.element(appElement1).scope();
                scope1.selectedPart = selected;
                
                scope1.$apply();
                scope1.initAlldata();
                break;
            }

        }
        $("#partListModal").modal("hide");
    }

    function cancelAddr() {
        $("#partListModal").modal("hide");
    }

</script>
